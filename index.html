<!doctype html>
<html>
	<head>
		<title>hyeong-minify</title>
		<script src="lib/bundle.js"></script>
	</head>
	<body>
		<article style="font-family: sans-serif;">
			<h1>난해한 혀엉... 언어 Minify</h1>
			<section>
				<a href="https://gist.github.com/xnuk/d9f883ede568d97caa158255e4b4d069/836a208b5d9fe729eb0d2fd9bf73aec7dc155ffb">난해한 혀엉... 언어 명세</a><br>
				<a href="https://xnuk.github.io/elmhyeong/">난해한 혀엉... 언어 Elm 구현체</a>(<a href="https://github.com/xnuk/elmhyeong">github</a>)
			</section>
			<section>
				<textarea id="hyeong" style="display: block; font-size: inherit; width: 100%; height: 300px; border: 1px solid black;">
혀엉..... 흑... 하앗... 흐으으으으으으으으으윽...
형.... 하앙. 혀어어엉..... 형. 하아앙. 형. 하앙.
혀엉..... 형. 하아앙. 혀엉..... 하앙. 형... 하앙.
혀어엉... 형..... 하앗. 혀어엉... 하앙. 형..... 하앙.
혀엉..... 하앙. 형..... 하앙. 혀엉. 하앙.
혀어어엉..... 형. 하아앙... 흑. 흣</textarea>
			</section>
			<section style="border: 1px solid grey; margin: 10px; padding: 10px; box-sizing: border-box;">
				<label title="명령어 사이에 있는 문자를 유지합니다.&#10;(예 혀♥엉 -> 혀♥엉)">
					<input type="checkbox" id="option-hangul-keep" />
					문자 유지
				</label>
				<label title="말줄임표로 .만을 사용합니다. &#10;(예 혀엉… -> 혀엉...)">
					<input type="checkbox" id="option-ellipsis-keep" />
					. Only
				</label>
				<div style="font-size: 10pt;" title=""><span style="color: red;">경고</span> 일부 설정은 최적한 결과를 가져오지 않을 수 있습니다.</div>
			</section>
			<section>
				<input id="minify" type="button" value="Minify" />
				<label>
					<input id="auto-minify" type="checkbox" />
					Auto-minify
				</label>
				<span id="original-length" style="font-weight: bold;"></span>文字から<span id="result-length" style="font-weight: bold;"></span><span id="delta" style="font-weight: bold; color: red;"></span>文字になりました。
			</section>
				<div id="display" style="display: block; font-size: inherit; width: 100%; height: 300px; border: 1px solid black; overflow-wrap: break-word;"></div>
			</section>
		</article>
		<script>

		var $hyeong = document.getElementById("hyeong");

		// options
		var $ohk = document.getElementById("option-hangul-keep");
		var $oek = document.getElementById("option-ellipsis-keep");

		var $minify = document.getElementById("minify");
		var $am = document.getElementById("auto-minify");
		var $ol = document.getElementById("original-length");
		var $rl = document.getElementById("result-length");

		var $delta = document.getElementById("delta");
		var $display = document.getElementById("display");

		var state = {
			checked: true,
			result: "",
			keepHangul: false,
			keepEllipsis: false
		};

		function setState(next){
			state = Object.assign({}, state, next);

			update();
		};

		function update () {
			$am.checked = state.checked;
			$display.innerHTML = state.result.result;
			$ol.innerHTML = state.result.original.length;
			$rl.innerHTML = state.result.result.length;
			$delta.innerHTML = "(" + (state.result.result.length - state.result.original.length) + ")";

			console.log(state);
		};

		function minify(){
			setState({
				result: hyeong.minify($hyeong.value, {
					hangul: {
						keep: state.keepHangul
					},
					ellipsis: {
						keep: state.keepEllipsis
					}
				})
			});
		}

		$am.addEventListener("change", function(e){
			setState({
				checked: e.target.checked
			});
		});

		function handler(e){
			if(state.checked){
				minify();
			}
		}

		$hyeong.addEventListener("change", handler);
		$hyeong.addEventListener("keyup", handler);

		$ohk.addEventListener("change", function(e){
			setState({
				keepHangul: e.target.checked
			});
			if(state.checked){
				minify();
			}
		});
		$oek.addEventListener("change", function(e){
			setState({
				keepEllipsis: e.target.checked
			});
			if(state.checked){
				minify();
			}
		});

		$minify.addEventListener("click", function(e){
			minify();
		});

		minify();

		</script>
	</body>
</html>
